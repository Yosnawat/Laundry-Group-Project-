<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Laundry System - Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .app-container { max-width: 1000px; width: 95%; margin: 20px auto; background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .view { display: none; padding: 2rem; }
        .primary-btn { background-color: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s, transform 0.1s; }
        .primary-btn:hover { background-color: #2563eb; }
        .primary-btn:active { transform: scale(0.98); }
        .tab-btn { display: inline-block; py: 1; px: 3; font-size: 0.875rem; border-bottom-width: 2px; border-color: transparent; }
        .tab-btn:hover { border-color: #9ca3af; }
        .tab-btn.active { border-color: #3b82f6; color: #3b82f6; font-weight: 700; }
        .card { background-color: #f9fafb; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .machine-available { border-left: 4px solid #10b981; } /* emerald-500 */
        .machine-in-use { border-left: 4px solid #f97316; } /* orange-500 */
    </style>
</head>
<body>

<div class="app-container">
    <nav id="navbar" class="p-4 border-b border-gray-100 flex justify-between items-center rounded-t-xl bg-gray-50">
        <h1 class="text-2xl font-bold text-gray-800">Laundry Hub</h1>
        <div class="flex space-x-4 items-center">
            <div id="nav-tabs" class="space-x-2">
                <a href="/student/dashboard" class="tab-btn">Dashboard</a>
                <a href="/student/booking" id="nav-booking-link" class="tab-btn active">Booking</a>
                </div>
            <span id="user-info" class="text-sm text-gray-600 font-medium hidden sm:inline"></span>
        </div>
    </nav>

    <div id="message-box" class="fixed top-5 right-5 z-50"></div>
    
    <div id="booking-view" class="view">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Machine Booking</h2>

        <div class="mb-6 flex space-x-4">
            <label class="flex items-center space-x-2">
                <input type="radio" name="machine_type" value="All" checked class="text-blue-600 focus:ring-blue-500">
                <span>All Machines</span>
            </label>
            <label class="flex items-center space-x-2">
                <input type="radio" name="machine_type" value="Washer" class="text-blue-600 focus:ring-blue-500">
                <span>Washers</span>
            </label>
            <label class="flex items-center space-x-2">
                <input type="radio" name="machine_type" value="Dryer" class="text-blue-600 focus:ring-blue-500">
                <span>Dryers</span>
            </label>
        </div>

        <div id="machine-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <p class="text-gray-500 col-span-full">Loading machine status...</p>
        </div>
    </div>

    </div>

<script>
    // --- GLOBAL DATA & STATE ---
    const users = [
        { id: 'S12345', email: 'student@uni.edu', password: '123', role: 'Student', name: 'Alice Student' },
        { id: 'M99', email: 'manager@uni.edu', password: '123', role: 'Manager', name: 'Bob Manager' }
    ];

    const machines = [
        { id: 'W-01', name: 'Washer 1', type: 'Washer', status: 'Available', next_available: 'Ready now', location: 'Floor 1', capacity: 'Large' },
        { id: 'D-01', name: 'Dryer 1', type: 'Dryer', status: 'In Use', next_available: '11:30 AM', location: 'Floor 1', capacity: 'Large' },
        { id: 'W-02', name: 'Washer 2', type: 'Washer', status: 'Available', next_available: 'Ready now', location: 'Floor 2', capacity: 'Medium' },
        { id: 'W-03', name: 'Washer 3', type: 'Washer', status: 'In Use', next_available: '12:00 PM', location: 'Floor 2', capacity: 'Medium' },
        { id: 'D-02', name: 'Dryer 2', type: 'Dryer', status: 'Available', next_available: 'Ready now', location: 'Floor 1', capacity: 'Small' },
    ];

    let currentUser = users[0]; // Auto-login as Alice Student

    // --- UTILITIES ---
    function showMessage(message, type = 'info') {
        const baseClass = "p-4 mb-2 rounded-lg shadow-lg text-white font-semibold transition-opacity duration-300";
        let colorClass = type === 'success' ? 'bg-emerald-500' : (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
        const $msg = $(`<div class="${baseClass} ${colorClass}">${message}</div>`);
        $('#message-box').append($msg);
        $msg.fadeIn(300).delay(3000).fadeOut(500, function() { $(this).remove(); });
    }

    /**
     * Shows the specified view. On this page, it just shows booking-view.
     */
    function showView(viewId) {
        $('.view').hide();
        $(`#${viewId}`).show();
        
        // On this page, booking is always active
        $('#nav-booking-link').addClass('active');

        // Run specific view loading logic
        if (viewId === 'booking-view') {
            renderMachineList('All');
        }
    }

    // --- AUTHENTICATION LOGIC ---
    function authenticateUser(user) {
        $('#navbar').removeClass('hidden');
        $('#user-info').text(`${user.name} (${user.role})`).show();
        
        // This page is only for students, so we don't need role checks
        // We just show the booking view
        showView('booking-view');
    }

    // --- DASHBOARD LOGIC (REMOVED) ---

    // --- BOOKING LOGIC (Student) ---
    function renderMachineList(filterType) {
        const $list = $('#machine-list').empty();
        let filteredMachines = machines;

        if (filterType !== 'All') {
            filteredMachines = machines.filter(m => m.type === filterType);
        }

        if (filteredMachines.length === 0) {
            $list.html(`<p class="text-gray-500 col-span-full">No ${filterType} machines available in the system.</p>`);
            return;
        }

        filteredMachines.forEach(machine => {
            const isAvailable = machine.status === 'Available';
            const statusClass = isAvailable ? 'machine-available' : (machine.status === 'In Use' ? 'machine-in-use' : 'border-left: 4px solid #9ca3af;');
            const statusText = isAvailable ? 'Ready Now' : machine.next_available;
            const buttonText = isAvailable ? 'Book Now' : 'View Status';
            const buttonColor = isAvailable ? 'bg-emerald-500 hover:bg-emerald-600' : 'bg-gray-400 cursor-default';

            const html = `
                <div class="card ${statusClass} flex justify-between items-center transition duration-300 hover:shadow-lg">
                    <div>
                        <p class="text-xl font-bold text-gray-800">${machine.name} (${machine.type})</p>
                        <p class="text-sm text-gray-500">${machine.location} - ${machine.capacity}</p>
                        <p class="mt-2 font-semibold text-base ${isAvailable ? 'text-emerald-600' : 'text-orange-600'}">
                            Status: ${machine.status}
                        </p>
                        <p class="text-xs text-gray-700">Next Available: ${statusText}</p>
                    </div>
                    <button data-id="${machine.id}" class="machine-book-btn text-white py-2 px-4 rounded-full text-sm font-semibold ${buttonColor}" ${isAvailable ? '' : 'disabled'}>
                        ${buttonText}
                    </button>
                </div>
            `;
            $list.append(html);
        });
    }

    // Filter change handler
    $('input[name="machine_type"]').on('change', function() {
        renderMachineList($(this).val());
    });

    // Booking handler (Delegated event)
    $('#machine-list').on('click', '.machine-book-btn', function() {
        const machineId = $(this).data('id');
        const machine = machines.find(m => m.id === machineId);

        if (!machine || machine.status !== 'Available') {
            showMessage('This machine is not currently available for booking.', 'error');
            return;
        }

        const $btn = $(this);
        $btn.text('Booking...').prop('disabled', true).removeClass('bg-emerald-500 hover:bg-emerald-600').addClass('bg-gray-500');

        setTimeout(() => {
            machine.status = 'In Use';
            machine.next_available = new Date(Date.now() + 60 * 60 * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            renderMachineList($('input[name="machine_type"]:checked').val());
            showMessage(`Success! You have booked ${machine.name} until ${machine.next_available}.`, 'success');
        }, 1000);
    });

    // --- ADMIN LOGIC (REMOVED) ---

    // --- INITIALIZATION ---
    $(document).ready(function() {
        authenticateUser(currentUser);
        // Note: The click handler for nav tabs is removed, 
        // as this page only has standard <a> links for navigation.
    });

</script>
</body>
</html>