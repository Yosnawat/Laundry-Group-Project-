<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Laundry System - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .app-container { max-width: 1000px; width: 95%; margin: 20px auto; background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .view { display: none; padding: 2rem; }
        .primary-btn { background-color: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s, transform 0.1s; }
        .primary-btn:hover { background-color: #2563eb; }
        .primary-btn:active { transform: scale(0.98); }
        .tab-btn { display: inline-block; py: 1; px: 3; font-size: 0.875rem; border-bottom-width: 2px; border-color: transparent; }
        .tab-btn:hover { border-color: #9ca3af; }
        .tab-btn.active { border-color: #3b82f6; color: #3b82f6; font-weight: 700; }
        .card { background-color: #f9fafb; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body>

<div class="app-container">
    <nav id="navbar" class="p-4 border-b border-gray-100 flex justify-between items-center rounded-t-xl bg-gray-50">
        <h1 class="text-2xl font-bold text-gray-800">Laundry Hub</h1>
        <div class="flex space-x-4 items-center">
            <div id="nav-tabs" class="space-x-2">
                <button data-target="dashboard-view" class="tab-btn active">Dashboard</button>
                <a href="/student/booking" id="nav-booking-link" class="tab-btn hidden">Booking</a>
                <button data-target="admin-view" id="nav-admin-link" class="tab-btn hidden">Admin Panel</button>
            </div>
            <span id="user-info" class="text-sm text-gray-600 font-medium hidden sm:inline"></span>
        </div>
    </nav>

    <div id="message-box" class="fixed top-5 right-5 z-50"></div>
    
    <div id="dashboard-view" class="view">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Welcome, <span id="user-display-name"></span></h2>

        <div id="student-dashboard" class="hidden">
            <h3 class="text-xl font-semibold mb-4 text-blue-600">Your Bookings</h3>
            <div id="student-bookings" class="space-y-4">
                <p class="text-gray-500">No active bookings found. Ready to do some laundry?</p>
            </div>

            <h3 class="text-xl font-semibold mt-8 mb-4 text-blue-600">Quick Status Overview</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="dashboard-stats">
                </div>
            <p class="mt-6 text-center">
                <a href="/student/booking" class="primary-btn">Go to Booking Page</a>
            </p>
        </div>

        <div id="manager-dashboard" class="hidden">
            <h3 class="text-xl font-semibold mb-4 text-orange-600">System Performance Metrics</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="manager-stats">
                 </div>

            <h3 class="text-xl font-semibold mt-8 mb-4 text-orange-600">Recent System Activity (Simulated)</h3>
            <ul class="space-y-2 text-sm card">
                <li class="border-b pb-2">Student S123 booked Washer 3 at 10:00 AM.</li>
                <li class="border-b pb-2">Washer 1 completed cycle and is now available.</li>
                <li class="pb-0">Manager M99 checked system logs.</li>
            </ul>
        </div>
    </div>

    <div id="admin-view" class="view">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Manager Administration Panel</h2>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 card">
                <h3 class="text-xl font-semibold mb-4">Machine Status Control</h3>
                <div id="admin-machine-list" class="space-y-4">
                    <p class="text-gray-500">Loading machines...</p>
                </div>
            </div>

            <div class="card">
                <h3 class="text-xl font-semibold mb-4">User Management Summary</h3>
                <ul id="admin-user-summary" class="space-y-3">
                    </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // --- GLOBAL DATA & STATE ---
    const users = [
        { id: 'S12345', email: 'student@uni.edu', password: '123', role: 'Student', name: 'Alice Student' },
        { id: 'M99', email: 'manager@uni.edu', password: '123', role: 'Manager', name: 'Bob Manager' }
    ];

    const machines = [
        { id: 'W-01', name: 'Washer 1', type: 'Washer', status: 'Available', next_available: 'Ready now', location: 'Floor 1', capacity: 'Large' },
        { id: 'D-01', name: 'Dryer 1', type: 'Dryer', status: 'In Use', next_available: '11:30 AM', location: 'Floor 1', capacity: 'Large' },
        { id: 'W-02', name: 'Washer 2', type: 'Washer', status: 'Available', next_available: 'Ready now', location: 'Floor 2', capacity: 'Medium' },
    ];

    const machine_statuses = {
        'Available': 'Available',
        'In Use': 'In Use',
        'Out of Service': 'Out of Service'
    };

    let currentUser = users[0]; // Auto-login as Alice Student

    // --- UTILITIES ---
    function showMessage(message, type = 'info') {
        const baseClass = "p-4 mb-2 rounded-lg shadow-lg text-white font-semibold transition-opacity duration-300";
        let colorClass = type === 'success' ? 'bg-emerald-500' : (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
        const $msg = $(`<div class="${baseClass} ${colorClass}">${message}</div>`);
        $('#message-box').append($msg);
        $msg.fadeIn(300).delay(3000).fadeOut(500, function() { $(this).remove(); });
    }

    /**
     * Switches the main application view.
     * @param {string} viewId - ID of the view to show (e.g., 'dashboard-view').
     */
    function showView(viewId) {
        $('.view').hide();
        $(`#${viewId}`).show();
        
        // Update active tab
        $('#nav-tabs .tab-btn').removeClass('active');
        $(`#nav-tabs .tab-btn[data-target="${viewId}"]`).addClass('active');

        // Run specific view loading logic
        if (viewId === 'dashboard-view') {
            loadDashboard();
        } else if (viewId === 'admin-view') {
            renderAdminView();
        }
    }

    // --- AUTHENTICATION LOGIC ---
    function authenticateUser(user) {
        $('#navbar').removeClass('hidden');
        $('#user-info').text(`${user.name} (${user.role})`).show();
        $('#user-display-name').text(user.name);

        if (user.role === 'Student') {
            $('#student-dashboard').removeClass('hidden');
            $('#manager-dashboard').addClass('hidden');
            $('#nav-booking-link').removeClass('hidden');
            showView('dashboard-view');
        } else if (user.role === 'Manager') {
            $('#manager-dashboard').removeClass('hidden');
            $('#student-dashboard').addClass('hidden');
            $('#nav-admin-link').removeClass('hidden');
            showView('dashboard-view');
        }

        showMessage(`Welcome back, ${user.name}!`, 'success');
    }

    // --- DASHBOARD LOGIC ---
    function loadDashboard() {
        if (!currentUser) return;
        if (currentUser.role === 'Student') {
            const availableCount = machines.filter(m => m.status === 'Available').length;
            const inUseCount = machines.filter(m => m.status === 'In Use').length;
            const totalCount = machines.length;
            const statsHtml = `
                <div class="card bg-blue-500 text-white"><p class="text-sm opacity-80">Total Machines</p><p class="text-3xl font-bold mt-1">${totalCount}</p></div>
                <div class="card bg-emerald-500 text-white"><p class="text-sm opacity-80">Machines Available</p><p class="text-3xl font-bold mt-1">${availableCount}</p></div>
                <div class="card bg-amber-500 text-white"><p class="text-sm opacity-80">Machines In Use</p><p class="text-3xl font-bold mt-1">${inUseCount}</p></div>`;
            $('#dashboard-stats').html(statsHtml);
            
            // ... (rest of student dashboard logic)
             $('#student-bookings').html('<p class="text-gray-500">No active bookings found. Ready to do some laundry?</p>');

        } else if (currentUser.role === 'Manager') {
            const availableWashers = machines.filter(m => m.type === 'Washer' && m.status === 'Available').length;
            const totalWashers = machines.filter(m => m.type === 'Washer').length;
            const availableDryers = machines.filter(m => m.type === 'Dryer' && m.status === 'Available').length;
            const totalDryers = machines.filter(m => m.type === 'Dryer').length;
            const outOfService = machines.filter(m => m.status === 'Out of Service').length;
            const statsHtml = `
                <div class="card bg-fuchsia-600 text-white"><p class="text-sm opacity-80">Washers Available</p><p class="text-3xl font-bold mt-1">${availableWashers} / ${totalWashers}</p></div>
                <div class="card bg-purple-600 text-white"><p class="text-sm opacity-80">Dryers Available</p><p class="text-3xl font-bold mt-1">${availableDryers} / ${totalDryers}</p></div>
                <div class="card bg-red-600 text-white"><p class="text-sm opacity-80">Out of Service</p><p class="text-3xl font-bold mt-1">${outOfService}</p></div>`;
            $('#manager-stats').html(statsHtml);
        }
    }
    
    // --- BOOKING LOGIC (REMOVED) ---

    // --- ADMIN LOGIC (Manager) ---
    function renderAdminView() {
        if (currentUser.role !== 'Manager') return;
        const $adminMachineList = $('#admin-machine-list').empty();
        machines.forEach(machine => {
            const currentStatus = machine.status;
            const statusColor = currentStatus === 'Available' ? 'text-emerald-600' : (currentStatus === 'In Use' ? 'text-orange-600' : 'text-red-600');
            const statusOptions = Object.keys(machine_statuses).map(status =>
                `<option value="${status}" ${status === currentStatus ? 'selected' : ''}>${status}</option>`
            ).join('');
            const html = `
                <div class="flex items-center justify-between p-3 border-b hover:bg-gray-100 rounded-lg transition duration-150">
                    <div class="flex-grow"><p class="font-bold">${machine.name} (${machine.id})</p><p class="text-sm ${statusColor}">Current: ${currentStatus}</p></div>
                    <select data-id="${machine.id}" class="machine-status-select border border-gray-300 rounded-md p-1 text-sm mr-4 w-40">${statusOptions}</select>
                    <button data-id="${machine.id}" class="update-machine-btn primary-btn py-1 px-3 text-xs">Update</button>
                </div>`;
            $adminMachineList.append(html);
        });

        const $adminUserSummary = $('#admin-user-summary').empty();
        users.forEach(user => {
            const roleColor = user.role === 'Manager' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700';
            $adminUserSummary.append(`
                <li class="flex justify-between items-center border-b pb-2">
                    <span class="font-medium">${user.name}</span>
                    <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${roleColor}">${user.role}</span>
                    <span class="text-xs text-gray-500">${user.id}</span>
                </li>`);
        });
    }

    $('#admin-machine-list').on('click', '.update-machine-btn', function() {
        const machineId = $(this).data('id');
        const newStatus = $(this).closest('.flex').find('.machine-status-select').val();
        const machine = machines.find(m => m.id === machineId);
        if (!machine) return;
        const $btn = $(this);
        $btn.text('Saving...').prop('disabled', true);
        setTimeout(() => {
            machine.status = newStatus;
            machine.next_available = newStatus === 'Available' ? 'Ready now' : machine.next_available;
            showMessage(`${machine.name} status updated to: ${newStatus}`, 'info');
            $btn.text('Update').prop('disabled', false);
            renderAdminView();
        }, 1000);
    });

    // --- INITIALIZATION ---
    $(document).ready(function() {
        authenticateUser(currentUser);

        // Global navigation handler (for Dashboard/Admin toggle)
        $(document).on('click', '#nav-tabs button.tab-btn', function() {
            const target = $(this).data('target');
            showView(target);
        });
    });

</script>
</body>
</html>